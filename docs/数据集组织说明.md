# GoPro视频去模糊数据集组织说明

根据配置文件 `options/vrt/006_train_vrt_videodeblurring_gopro.json`，以下是数据集的组织要求：

## 一、训练数据集（LMDB格式）

### 1.1 需要的文件

训练数据集需要转换为LMDB格式，需要以下文件：

- **GT（清晰图像）LMDB**: `trainsets/GoPro/train_GT.lmdb`
- **LQ（模糊图像）LMDB**: `trainsets/GoPro/train_GT_blurred.lmdb`
- **Meta信息文件**: `data/meta_info/meta_info_GoPro_train_GT.txt`

### 1.2 原始数据组织方式

在转换为LMDB之前，原始图像数据应该按以下结构组织：

```
trainsets/GoPro/
├── train_GT/                    # 清晰图像文件夹
│   ├── GOPR0372_07_00/          # 视频片段文件夹
│   │   ├── 000047.png           # 帧图像（从起始帧号开始）
│   │   ├── 000048.png
│   │   ├── ...
│   │   └── 000146.png           # 共100帧（根据meta_info）
│   ├── GOPR0372_07_01/          # 下一个视频片段
│   │   ├── 000601.png           # 从000601开始
│   │   ├── ...
│   │   └── 000675.png           # 共75帧
│   └── ...
└── train_GT_blurred/            # 模糊图像文件夹（结构相同）
    ├── GOPR0372_07_00/
    │   ├── 000047.png
    │   ├── 000048.png
    │   └── ...
    └── ...
```

**重要要求**：
- GT和LQ文件夹下的子文件夹名称必须完全一致
- 每个子文件夹内的帧图像编号必须完全对应
- 图像格式：PNG（根据配置中的 `filename_ext: "png"`）
- 帧编号格式：6位数字，如 `000047`（根据配置中的 `filename_tmpl: "06d"`）

### 1.3 Meta信息文件格式

文件路径：`data/meta_info/meta_info_GoPro_train_GT.txt`

每行格式：
```
文件夹名 帧数 (高度,宽度,通道数) 起始帧号
```

示例：
```
GOPR0372_07_00 100 (720,1280,3) 000047
GOPR0372_07_01 75 (720,1280,3) 000601
GOPR0374_11_00 150 (720,1280,3) 000001
```

**说明**：
- `文件夹名`: 视频片段文件夹名称（如 `GOPR0372_07_00`）
- `帧数`: 该片段包含的帧数（如 `100`）
- `(高度,宽度,通道数)`: 图像尺寸信息（如 `(720,1280,3)`）
- `起始帧号`: 第一帧的编号（如 `000047`）

### 1.4 创建LMDB数据集

使用项目提供的脚本创建LMDB：

```bash
python create_lmdb.py --dataset GoPro
```

该脚本会：
1. 读取 `trainsets/GoPro/train_GT/` 和 `trainsets/GoPro/train_GT_blurred/` 文件夹
2. 根据文件夹结构生成keys（格式：`文件夹名/帧号`，如 `GOPR0372_07_00/000047`）
3. 将图像转换为LMDB格式
4. 生成对应的 `.lmdb` 文件夹

## 二、测试数据集（磁盘格式）

### 2.1 需要的文件夹

测试数据集不需要转换为LMDB，直接使用磁盘上的图像文件：

- **GT文件夹**: `testsets/GoPro11/test_GT/`
- **LQ文件夹**: `testsets/GoPro11/test_GT_blurred/`

### 2.2 数据组织方式

```
testsets/GoPro11/
├── test_GT/                     # 清晰图像文件夹
│   ├── 视频片段1/               # 子文件夹名称
│   │   ├── 00000000.png         # 帧图像
│   │   ├── 00000001.png
│   │   ├── ...
│   ├── 视频片段2/
│   │   ├── 00000000.png
│   │   └── ...
│   └── ...
└── test_GT_blurred/             # 模糊图像文件夹（结构相同）
    ├── 视频片段1/
    │   ├── 00000000.png
    │   ├── 00000001.png
    │   └── ...
    └── ...
```

**重要要求**：
- GT和LQ文件夹下的子文件夹名称必须完全一致
- 每个子文件夹内的帧图像数量必须相同
- 图像会按文件名自动排序加载

### 2.3 可选：Meta信息文件

如果测试集有meta_info文件，可以指定：
```json
"meta_info_file": "data/meta_info/meta_info_GoPro11_test_GT.txt"
```

如果没有指定，会自动扫描文件夹下的所有子文件夹。

## 三、验证数据集

### 3.1 检查训练数据集

```bash
# 检查LMDB文件是否存在
ls -lh trainsets/GoPro/train_GT.lmdb/
ls -lh trainsets/GoPro/train_GT_blurred.lmdb/

# 检查meta_info文件
cat data/meta_info/meta_info_GoPro_train_GT.txt
```

### 3.2 检查测试数据集

```bash
# 检查文件夹结构
ls testsets/GoPro11/test_GT/
ls testsets/GoPro11/test_GT_blurred/

# 检查某个视频片段的帧数是否一致
ls testsets/GoPro11/test_GT/视频片段1/ | wc -l
ls testsets/GoPro11/test_GT_blurred/视频片段1/ | wc -l
```

## 四、配置参数说明

根据配置文件，关键参数：

- **训练数据集**:
  - `num_frame: 6` - 每次训练使用6帧
  - `gt_size: 224` - 训练时裁剪的patch大小
  - `filename_tmpl: "06d"` - 帧编号格式（6位数字）
  - `filename_ext: "png"` - 图像格式

- **测试数据集**:
  - `num_frame: -1` - 使用所有帧
  - `num_frame_testing: 18` - 测试时使用的帧数
  - `num_frame_overlapping: 2` - 重叠帧数
  - `size_patch_testing: 224` - 测试patch大小

## 五、常见问题

1. **LMDB文件已存在**: 如果LMDB文件已存在，脚本会跳过创建。需要删除旧文件才能重新创建。

2. **帧编号不连续**: 帧编号必须从起始帧号开始连续编号，不能有缺失。

3. **GT和LQ不匹配**: GT和LQ文件夹下的子文件夹名称和帧图像必须一一对应。

4. **图像格式**: 确保所有图像都是PNG格式，且文件名符合 `filename_tmpl` 格式。

