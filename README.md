# S-VRT: Spike-Enhanced Video Restoration Transformer

GoPro+Spike Video Deblurring using VRT (Video Restoration Transformer) with spike camera data fusion.

## ğŸš€ Quick Start

### 1. Analyze Hardware & Optimize Configuration (Recommended for first-time use)
```bash
python scripts/analyze_hardware_training.py
```
This will:
- Detect your GPU, CPU, and RAM
- Run performance benchmarks
- Analyze configuration feasibility
- Generate optimized config for your hardware

### 2. Check System Status
```bash
python tests/integration/training/test_system_readiness.py
```

### 3. Start Training
```bash
# Use the optimized config generated by step 1
python src/train.py --config configs/deblur/vrt_spike_baseline_optimized.yaml

# Or use the default config
python src/train.py --config configs/deblur/vrt_spike_baseline.yaml
```

### 4. Monitor Training
```bash
tensorboard --logdir outputs/logs/tb

# æˆ–è€…å¯ç”¨ W&B ä»ªè¡¨ç›˜ï¼ˆéœ€æå‰ç™»å½•ï¼‰
wandb login
python src/train.py --config configs/deblur/vrt_spike_baseline.yaml LOG.WANDB.ENABLE=true LOG.WANDB.PROJECT=deblur
```

---

## ğŸ“Š Project Status

**Status**: âœ… READY TO TRAIN  
**Dataset**: 2,015 training samples  
**Mode**: Real-time spike voxel generation  

---

## ğŸ“š Documentation

Comprehensive documentation is available in the `docs/` directory:

### Core Documentation
- **[Quick Start Guide](docs/QUICK_START.md)** - å¿«é€Ÿå¼€å§‹è®­ç»ƒ
- **[Configuration Guide](docs/CONFIG_GUIDE.md)** - å®Œæ•´é…ç½®è¯´æ˜
- **[Data Guide](docs/DATA_GUIDE.md)** - æ•°æ®é›†å’ŒDataLoaderé…ç½®
- **[Architecture Overview](docs/ARCHITECTURE.md)** - æ¨¡å‹æ¶æ„å’Œæ•°æ®æµ

### Optimization & Performance
- **[Performance Optimization](docs/PERFORMANCE_OPTIMIZATION_GUIDE.md)** - æ€§èƒ½å’Œå†…å­˜ä¼˜åŒ–å®Œæ•´æŒ‡å—

### Additional Resources
- **[Documentation Index](docs/README.md)** - å®Œæ•´æ–‡æ¡£ç´¢å¼•
- **[Testing Guide](tests/README.md)** - æµ‹è¯•ç³»ç»Ÿè¯´æ˜

---

## âš¡ Hardware Analysis & Optimization

**New to the project?** Start here to optimize your training configuration for your specific hardware.

```bash
python scripts/analyze_hardware_training.py
```

This powerful tool will:
- ğŸ” **Auto-detect** your GPU, CPU, and RAM specifications
- ğŸ“Š **Benchmark** GPU performance (FP32/FP16 speed, memory bandwidth)
- ğŸ’¡ **Analyze** your training configuration feasibility
- âš ï¸ **Warn** about potential OOM or performance issues
- âœ… **Recommend** optimal settings (batch size, workers, AMP, etc.)
- ğŸ“ **Generate** an optimized configuration file automatically

**Example output:**
```
ğŸŸ  [HIGH] Enable Mixed Precision Training (AMP)
   Reason: Your GPU's FP16 is 2.3x faster than FP32
   Action: Add TRAIN.USE_AMP: true to config
   Expected: 30% speedup, 45% memory reduction

âœ… Generated optimized config: configs/deblur/vrt_spike_baseline_optimized.yaml
```

See [scripts/README.md](scripts/README.md) for more details.

---

## ğŸ§ª Testing

The project includes comprehensive tests following SOTA project standards.

```bash
# System readiness check (recommended before training)
python tests/integration/training/test_system_readiness.py

# Run all tests with pytest
pytest tests/ -v

# Run specific test categories
pytest tests/unit/ -v                    # Unit tests
pytest tests/integration/ -v              # Integration tests
pytest tests/benchmark/ -v                # Performance benchmarks

# Or use the test runner
python tests/pytest_runner.py unit        # Unit tests only
python tests/pytest_runner.py integration # Integration tests only
python tests/pytest_runner.py all         # All tests
```

See [tests/README.md](tests/README.md) for detailed testing documentation.

---

## ğŸ“ Project Structure

```
Deblur/
â”œâ”€â”€ configs/                    # Configuration files
â”‚   â””â”€â”€ deblur/
â”‚       â””â”€â”€ vrt_spike_baseline.yaml
â”œâ”€â”€ src/                        # Source code
â”‚   â”œâ”€â”€ data/                   # Data loading
â”‚   â”œâ”€â”€ models/                 # Model implementations
â”‚   â”œâ”€â”€ losses/                 # Loss functions
â”‚   â”œâ”€â”€ train.py               # Training script
â”‚   â””â”€â”€ test.py                # Testing script
â”œâ”€â”€ tests/                      # Comprehensive test suite
â”‚   â”œâ”€â”€ unit/                   # Unit tests
â”‚   â”œâ”€â”€ integration/            # Integration tests
â”‚   â”œâ”€â”€ benchmark/              # Performance benchmarks
â”‚   â””â”€â”€ README.md              # Testing documentation
â”œâ”€â”€ scripts/                    # Utility scripts
â”‚   â””â”€â”€ prepare_gopro_spike_structure.py
â”œâ”€â”€ docs/                       # Documentation
â”œâ”€â”€ third_party/               # External dependencies
â”‚   â””â”€â”€ VRT/                   # Video Restoration Transformer
â”œâ”€â”€ data/                      # Dataset (not in repo)
â””â”€â”€ outputs/                   # Training outputs
```

---

## ğŸ”§ Requirements

- Python 3.8+
- PyTorch 1.10+
- CUDA 11.0+ (for GPU training)
- 32GB+ RAM recommended
- See `requirements.txt` for full dependencies

---

## ğŸ“– Key Features

- âœ… **Real-time spike voxel generation** - No pre-computed cache needed
- âœ… **Multi-resolution support** - Handles different image/spike resolutions
- âœ… **VRT backbone** - State-of-the-art video restoration
- âœ… **Temporal attention** - Fuses spike and RGB features
- âœ… **Flexible configuration** - Easy mode switching

---

## ğŸ“Š Dataset

**GoPro + Spike Unified Dataset**
- 22 training sequences
- 2,015 training samples
- Paired blur/sharp RGB frames (720Ã—1280)
- Spike camera data (252Ã—640 after processing)

---

## ğŸ“ Training Configuration

```yaml
BATCH_SIZE: 4
CROP_SIZE: 256
CLIP_LEN: 5
LEARNING_RATE: 0.0002
TOTAL_STEPS: 300000
NUM_VOXEL_BINS: 5
```

See `configs/deblur/vrt_spike_baseline.yaml` for full configuration.

---

## ğŸ“ Citation

If you use this code, please cite:

```bibtex
@article{liang2022vrt,
  title={VRT: A Video Restoration Transformer},
  author={Liang, Jingyun and Cao, Jiezhang and Fan, Yuchen and Zhang, Kai and Ranjan, Rakesh and Li, Yawei and Timofte, Radu and Van Gool, Luc},
  journal={arXiv preprint arXiv:2201.12288},
  year={2022}
}
```

---

## ğŸ“ Support

- **Documentation**: See `docs/` directory
- **Testing**: See `tests/README.md` for comprehensive test guide
- **Issues**: Check `docs/QUICKSTART.md` troubleshooting section
- **System check**: Run `python tests/integration/training/test_system_readiness.py`

---

**Ready to train! ğŸš€**

```bash
python src/train.py --config configs/deblur/vrt_spike_baseline.yaml
```
