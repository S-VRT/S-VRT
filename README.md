# GoPro+Spike Video Deblurring

Video deblurring using VRT (Video Restoration Transformer) with spike camera data fusion.

## 🚀 Quick Start

### 1. Analyze Hardware & Optimize Configuration (Recommended for first-time use)
```bash
python scripts/analyze_hardware_training.py
```
This will:
- Detect your GPU, CPU, and RAM
- Run performance benchmarks
- Analyze configuration feasibility
- Generate optimized config for your hardware

### 2. Check System Status
```bash
python tests/integration/training/test_system_readiness.py
```

### 3. Start Training
```bash
# Use the optimized config generated by step 1
python src/train.py --config configs/deblur/vrt_spike_baseline_optimized.yaml

# Or use the default config
python src/train.py --config configs/deblur/vrt_spike_baseline.yaml
```

### 4. Monitor Training
```bash
tensorboard --logdir outputs/logs/tb
```

---

## 📊 Project Status

**Status**: ✅ READY TO TRAIN  
**Dataset**: 2,015 training samples  
**Mode**: Real-time spike voxel generation  

---

## 📚 Documentation

Comprehensive documentation is available in the `docs/` directory:

### Core Documentation
- **[Quick Start Guide](docs/QUICK_START.md)** - 快速开始训练
- **[Configuration Guide](docs/CONFIG_GUIDE.md)** - 完整配置说明
- **[Data Guide](docs/DATA_GUIDE.md)** - 数据集和DataLoader配置
- **[Architecture Overview](docs/ARCHITECTURE.md)** - 模型架构和数据流

### Optimization & Performance
- **[Performance Optimization](docs/PERFORMANCE_OPTIMIZATION_GUIDE.md)** - 性能和内存优化完整指南

### Additional Resources
- **[Documentation Index](docs/README.md)** - 完整文档索引
- **[Testing Guide](tests/README.md)** - 测试系统说明

---

## ⚡ Hardware Analysis & Optimization

**New to the project?** Start here to optimize your training configuration for your specific hardware.

```bash
python scripts/analyze_hardware_training.py
```

This powerful tool will:
- 🔍 **Auto-detect** your GPU, CPU, and RAM specifications
- 📊 **Benchmark** GPU performance (FP32/FP16 speed, memory bandwidth)
- 💡 **Analyze** your training configuration feasibility
- ⚠️ **Warn** about potential OOM or performance issues
- ✅ **Recommend** optimal settings (batch size, workers, AMP, etc.)
- 📝 **Generate** an optimized configuration file automatically

**Example output:**
```
🟠 [HIGH] Enable Mixed Precision Training (AMP)
   Reason: Your GPU's FP16 is 2.3x faster than FP32
   Action: Add TRAIN.USE_AMP: true to config
   Expected: 30% speedup, 45% memory reduction

✅ Generated optimized config: configs/deblur/vrt_spike_baseline_optimized.yaml
```

See [scripts/README.md](scripts/README.md) for more details.

---

## 🧪 Testing

The project includes comprehensive tests following SOTA project standards.

```bash
# System readiness check (recommended before training)
python tests/integration/training/test_system_readiness.py

# Run all tests with pytest
pytest tests/ -v

# Run specific test categories
pytest tests/unit/ -v                    # Unit tests
pytest tests/integration/ -v              # Integration tests
pytest tests/benchmark/ -v                # Performance benchmarks

# Or use the test runner
python tests/pytest_runner.py unit        # Unit tests only
python tests/pytest_runner.py integration # Integration tests only
python tests/pytest_runner.py all         # All tests
```

See [tests/README.md](tests/README.md) for detailed testing documentation.

---

## 📁 Project Structure

```
Deblur/
├── configs/                    # Configuration files
│   └── deblur/
│       └── vrt_spike_baseline.yaml
├── src/                        # Source code
│   ├── data/                   # Data loading
│   ├── models/                 # Model implementations
│   ├── losses/                 # Loss functions
│   ├── train.py               # Training script
│   └── test.py                # Testing script
├── tests/                      # Comprehensive test suite
│   ├── unit/                   # Unit tests
│   ├── integration/            # Integration tests
│   ├── benchmark/              # Performance benchmarks
│   └── README.md              # Testing documentation
├── scripts/                    # Utility scripts
│   └── prepare_gopro_spike_structure.py
├── docs/                       # Documentation
├── third_party/               # External dependencies
│   └── VRT/                   # Video Restoration Transformer
├── data/                      # Dataset (not in repo)
└── outputs/                   # Training outputs
```

---

## 🔧 Requirements

- Python 3.8+
- PyTorch 1.10+
- CUDA 11.0+ (for GPU training)
- 32GB+ RAM recommended
- See `requirements.txt` for full dependencies

---

## 📖 Key Features

- ✅ **Real-time spike voxel generation** - No pre-computed cache needed
- ✅ **Multi-resolution support** - Handles different image/spike resolutions
- ✅ **VRT backbone** - State-of-the-art video restoration
- ✅ **Temporal attention** - Fuses spike and RGB features
- ✅ **Flexible configuration** - Easy mode switching

---

## 📊 Dataset

**GoPro + Spike Unified Dataset**
- 22 training sequences
- 2,015 training samples
- Paired blur/sharp RGB frames (720×1280)
- Spike camera data (252×640 after processing)

---

## 🎓 Training Configuration

```yaml
BATCH_SIZE: 4
CROP_SIZE: 256
CLIP_LEN: 5
LEARNING_RATE: 0.0002
TOTAL_STEPS: 300000
NUM_VOXEL_BINS: 5
```

See `configs/deblur/vrt_spike_baseline.yaml` for full configuration.

---

## 📝 Citation

If you use this code, please cite:

```bibtex
@article{liang2022vrt,
  title={VRT: A Video Restoration Transformer},
  author={Liang, Jingyun and Cao, Jiezhang and Fan, Yuchen and Zhang, Kai and Ranjan, Rakesh and Li, Yawei and Timofte, Radu and Van Gool, Luc},
  journal={arXiv preprint arXiv:2201.12288},
  year={2022}
}
```

---

## 📞 Support

- **Documentation**: See `docs/` directory
- **Testing**: See `tests/README.md` for comprehensive test guide
- **Issues**: Check `docs/QUICKSTART.md` troubleshooting section
- **System check**: Run `python tests/integration/training/test_system_readiness.py`

---

**Ready to train! 🚀**

```bash
python src/train.py --config configs/deblur/vrt_spike_baseline.yaml
```

